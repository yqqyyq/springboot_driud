<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WebChat | down</title>
    <meta name="author" content="小柒2012"/>
    <meta name="site" content="https://blog.52itstyle.com"/>
    <link rel="icon" th:href="@{/static/foc/index.ico}" type="image/x-icon"/>
    <link rel="stylesheet" th:href="@{/static/plugins/iview/iview.css}">
    <script th:src="@{/static/plugins/jquery/jquery-3.3.1.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/plugins/vue/vue.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/plugins/layer/layer.js}" type="text/javascript"></script>
    <script th:src="@{/static/plugins/iview/iview.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/plugins/common.js}" type="text/javascript"></script>
    <style type="text/css">
        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body>
<div id="app" v-cloak>
    <div style="margin-bottom: 6px">
        <template>
            <i-input placeholder="输入文件名" v-model="filelog.filename" style="width: 200px"></i-input>
        </template>
        <i-button type="primary" icon="ios-search" @click="list()">查询</i-button>
        <i-button type="primary" icon="refresh" @click="reload()">清空</i-button>
    </div>

    <template>
        <i-table border :content="self" :columns="tableTitle" :data="consultData"></i-table>
        <br>
        <!-- <Page :current="mail.pageNumber" :total="total" :page-size="mail.pageSize"  @on-change="changePage" @on-page-size-change="changePageSize" show-elevator show-sizer show-total></Page> -->
    </template>
</div>
<script type="text/javascript">
    var vm = new Vue({
        el: '#app',
        data: {
            filelog: {
                filename: ""
            },
            tableTitle: [{
                key: "filename",
                title: "文件",
                width: "",
            }, {
                key: "fileuser",
                title: "用户",
                width: ""
            }, {
                key: "filesize",
                title: "大小",
                width: ""
            }, {
                key: "filetime",
                title: "时间",
                width: ""
            }, {
                key: "filepath",
                title: "操作",
                width: "",
                render: function (h, params) {
                    var functionList = [];
                    //执行
                    /*var downfile = h('Button', {
                        props: {
                            type: 'primary',
                            size: 'small',
                            icon: 'ios-play'
                        },
                        style: {
                            marginRight: '8px'
                        },
                        on: {
                            click: function () {
                                vm.downfile(params.row.fileuser,params.row.filename, params.row.filepath);
                            }
                        }
                    }, '下载');
                    functionList.push(downfile);
                    // 返回方法集合
                    return h('div', functionList);*/

                    var url = '../downfile?filename='+params.row.filename+'&filepath='+params.row.fileuser+"/"+params.row.filepath;
                    return h('a', {
                        props: {
                            type: 'primary',
                            size: 'small',
                            icon: 'ios-play'
                        },
                        style: {
                            marginRight: '8px'
                        },
                        attrs: {
                            href: url
                        }
                    }, "下载");
                },
            }],
            consultData: []
        },
        methods: {
            list: function () {
                $.ajax({
                    url: '../filelistpost',
                    type: "post",
                    param: this.filelog,
                    success: function (result) {
                        vm.consultData = result.msg;

                    }
                });
            },
            reload: function (type) {
                this.list();
            },
            //触发任务
            downfile: function (fileuser, filename,filepath) {
                $.ajax({
                    url: "../downfilepost",
                    type: "post",
                    data: {"fileuser": fileuser,"filename": filename, 'filepath': filepath},
                    success: function (result) {
                        alert(result);
                    }
                });
            }
            /*,
            initFormatter(){
                  Date.prototype.Format = function(fmt) {
                    let o = {
                        "M+" : this.getMonth()+1,                 //月份
                        "d+" : this.getDate(),                    //日
                        "h+" : this.getHours(),                   //小时
                        "m+" : this.getMinutes(),                 //分
                        "s+" : this.getSeconds(),                 //秒
                        "q+" : Math.floor((this.getMonth()+3)/3), //季度
                        "S"  : this.getMilliseconds()             //毫秒
                    };
                    if(/(y+)/.test(fmt))
                        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
                    for(var k in o)
                        if(new RegExp("("+ k +")").test(fmt))
                         fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
                    return fmt;
                  }
           } */
        },
        created: function () {
            this.list();
            //this.initFormatter();
        }

    });
</script>
</body>
</html>